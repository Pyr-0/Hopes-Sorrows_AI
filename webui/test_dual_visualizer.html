<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Visualizer Test - Hopes & Sorrows</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: white;
            overflow: hidden;
        }
        
        #visualization-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        .debug-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            min-width: 300px;
            backdrop-filter: blur(10px);
        }
        
        .debug-panel h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .debug-info {
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .debug-info strong {
            color: #4ECDC4;
        }
        
        .mode-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .mode-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }
        
        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .mode-btn.active {
            background: #FFD700;
            color: #000;
            border-color: #FFD700;
        }
        
        .test-controls {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .test-btn {
            background: #4ECDC4;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 5px;
            font-size: 12px;
            transition: background 0.3s ease;
        }
        
        .test-btn:hover {
            background: #45B7B8;
        }
        
        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
            color: #4CAF50;
        }
        
        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.5);
            color: #F44336;
        }
        
        .status.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.5);
            color: #2196F3;
        }
        
        .category-toggles {
            margin-top: 10px;
        }
        
        .category-toggle {
            display: inline-block;
            margin: 2px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .category-toggle.hope { background: rgba(255, 215, 0, 0.2); }
        .category-toggle.sorrow { background: rgba(74, 144, 226, 0.2); }
        .category-toggle.transformative { background: rgba(155, 89, 182, 0.2); }
        .category-toggle.ambivalent { background: rgba(231, 76, 60, 0.2); }
        .category-toggle.reflective_neutral { background: rgba(149, 165, 166, 0.2); }
        
        .category-toggle.active {
            opacity: 1;
            border-color: white;
        }
        
        .category-toggle.inactive {
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div id="visualization-container"></div>
    
    <div class="debug-panel">
        <h3>ðŸŽ­ Dual Visualizer Test</h3>
        
        <div class="debug-info">
            <strong>Current Mode:</strong> <span id="current-mode">Loading...</span>
        </div>
        <div class="debug-info">
            <strong>Blob Count:</strong> <span id="blob-count">0</span>
        </div>
        <div class="debug-info">
            <strong>Status:</strong> <span id="status">Initializing...</span>
        </div>
        
        <div class="mode-buttons">
            <button class="mode-btn" id="vortex-btn" data-mode="vortex">ðŸŒ€ GLSL Vortex</button>
            <button class="mode-btn" id="blobs-btn" data-mode="blobs">ðŸ«§ Floating Blobs</button>
        </div>
        
        <div class="category-toggles">
            <div class="category-toggle hope active" data-category="hope">Hope</div>
            <div class="category-toggle sorrow active" data-category="sorrow">Sorrow</div>
            <div class="category-toggle transformative active" data-category="transformative">Transform</div>
            <div class="category-toggle ambivalent active" data-category="ambivalent">Ambivalent</div>
            <div class="category-toggle reflective_neutral active" data-category="reflective_neutral">Reflective</div>
        </div>
        
        <div class="test-controls">
            <button class="test-btn" id="add-test-blob">Add Test Blob</button>
            <button class="test-btn" id="add-multiple-blobs">Add 5 Blobs</button>
            <button class="test-btn" id="clear-blobs">Clear All</button>
        </div>
        
        <div id="status-message" class="status info">
            Ready to test dual visualizer functionality
        </div>
    </div>

    <!-- Load all required scripts -->
    <script src="static/js/p5.min.js"></script>
    <script src="static/js/anime.min.js"></script>
    <script src="static/js/emotion-visualizer.js"></script>
    <script src="static/js/integrated-emotion-visualizer.js"></script>
    <script src="static/js/blob-visualizer.js"></script>
    <script src="static/js/dual-visualizer.js"></script>
    
    <script>
        console.log('ðŸŽ­ Starting Dual Visualizer Test...');
        
        let dualVisualizer;
        let testBlobCounter = 0;
        
        // DOM elements
        const statusEl = document.getElementById('status');
        const currentModeEl = document.getElementById('current-mode');
        const blobCountEl = document.getElementById('blob-count');
        const statusMessageEl = document.getElementById('status-message');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const categoryToggles = document.querySelectorAll('.category-toggle');
        
        // Test blob data templates
        const testBlobTemplates = [
            {
                category: 'hope',
                text: 'I feel optimistic about the future and believe things will get better.',
                confidence: 0.85,
                score: 0.7,
                speaker_name: 'Test User'
            },
            {
                category: 'sorrow',
                text: 'Sometimes I feel overwhelmed by sadness and loss.',
                confidence: 0.78,
                score: -0.6,
                speaker_name: 'Anonymous'
            },
            {
                category: 'transformative',
                text: 'This experience has changed me in ways I never expected.',
                confidence: 0.92,
                score: 0.4,
                speaker_name: 'Seeker'
            },
            {
                category: 'ambivalent',
                text: 'I have mixed feelings about this situation - both excited and worried.',
                confidence: 0.65,
                score: 0.1,
                speaker_name: 'Conflicted'
            },
            {
                category: 'reflective_neutral',
                text: 'I am taking time to think deeply about what this all means.',
                confidence: 0.70,
                score: 0.0,
                speaker_name: 'Philosopher'
            }
        ];
        
        async function initTest() {
            try {
                statusEl.textContent = 'Creating dual visualizer...';
                updateStatus('Initializing dual visualizer system...', 'info');
                
                // Check if required classes are available
                if (typeof DualEmotionVisualizer === 'undefined') {
                    throw new Error('DualEmotionVisualizer not found');
                }
                
                dualVisualizer = new DualEmotionVisualizer();
                
                statusEl.textContent = 'Initializing visualizers...';
                const container = document.getElementById('visualization-container');
                
                await dualVisualizer.init(container);
                
                statusEl.textContent = 'Ready!';
                updateStatus('Dual visualizer initialized successfully! Try switching modes and adding blobs.', 'success');
                
                // Update UI
                updateModeButtons();
                updateBlobCount();
                
                // Set up periodic updates
                setInterval(() => {
                    updateBlobCount();
                    updateCurrentMode();
                }, 1000);
                
                console.log('âœ… Dual visualizer test initialization complete');
                
            } catch (error) {
                console.error('âŒ Test failed:', error);
                statusEl.textContent = `Error: ${error.message}`;
                updateStatus(`Initialization failed: ${error.message}`, 'error');
            }
        }
        
        function updateStatus(message, type = 'info') {
            statusMessageEl.textContent = message;
            statusMessageEl.className = `status ${type}`;
        }
        
        function updateModeButtons() {
            const currentMode = dualVisualizer?.getCurrentMode() || 'vortex';
            modeButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === currentMode);
            });
        }
        
        function updateCurrentMode() {
            if (dualVisualizer) {
                const mode = dualVisualizer.getCurrentMode();
                const modeInfo = dualVisualizer.getModeInfo(mode);
                currentModeEl.textContent = modeInfo ? `${modeInfo.icon} ${modeInfo.name}` : mode;
            }
        }
        
        function updateBlobCount() {
            if (dualVisualizer) {
                blobCountEl.textContent = dualVisualizer.getBlobCount();
            }
        }
        
        function addTestBlob() {
            if (!dualVisualizer) return;
            
            const template = testBlobTemplates[testBlobCounter % testBlobTemplates.length];
            const blob = {
                ...template,
                id: `test_blob_${testBlobCounter++}`,
                created_at: new Date().toISOString(),
                intensity: Math.abs(template.score) + 0.2
            };
            
            dualVisualizer.addBlob(blob);
            updateStatus(`Added ${blob.category} blob: "${blob.text.substring(0, 30)}..."`, 'success');
            console.log('ðŸ«§ Added test blob:', blob);
        }
        
        function addMultipleBlobs() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => addTestBlob(), i * 200);
            }
            updateStatus('Adding 5 test blobs with staggered timing...', 'info');
        }
        
        function clearAllBlobs() {
            if (dualVisualizer) {
                dualVisualizer.clearAllBlobs();
                updateStatus('Cleared all blobs from visualization', 'info');
            }
        }
        
        function switchMode(mode) {
            if (dualVisualizer) {
                dualVisualizer.switchToMode(mode).then(success => {
                    if (success) {
                        updateModeButtons();
                        updateCurrentMode();
                        updateStatus(`Switched to ${mode} mode`, 'success');
                    } else {
                        updateStatus(`Failed to switch to ${mode} mode`, 'error');
                    }
                });
            }
        }
        
        function toggleCategory(category) {
            if (dualVisualizer) {
                const currentVisibility = dualVisualizer.getCategoryVisibility();
                const isVisible = currentVisibility.includes(category);
                
                dualVisualizer.setCategoryVisibility(category, !isVisible);
                
                // Update toggle button
                const toggle = document.querySelector(`[data-category="${category}"]`);
                if (toggle) {
                    toggle.classList.toggle('active', !isVisible);
                    toggle.classList.toggle('inactive', isVisible);
                }
                
                updateStatus(`${isVisible ? 'Hidden' : 'Shown'} ${category} emotions`, 'info');
            }
        }
        
        // Event listeners
        document.getElementById('add-test-blob').addEventListener('click', addTestBlob);
        document.getElementById('add-multiple-blobs').addEventListener('click', addMultipleBlobs);
        document.getElementById('clear-blobs').addEventListener('click', clearAllBlobs);
        
        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => switchMode(btn.dataset.mode));
        });
        
        categoryToggles.forEach(toggle => {
            toggle.addEventListener('click', () => toggleCategory(toggle.dataset.category));
        });
        
        // Keyboard shortcuts
        window.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case '1':
                    switchMode('vortex');
                    break;
                case '2':
                    switchMode('blobs');
                    break;
                case 'a':
                    addTestBlob();
                    break;
                case 'c':
                    clearAllBlobs();
                    break;
                case 'm':
                    addMultipleBlobs();
                    break;
            }
        });
        
        // Start the test
        initTest();
    </script>
</body>
</html> 